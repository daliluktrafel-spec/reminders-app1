<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ°ÙƒÙŠØ± ÙˆÙØ§Ø¡</title>

<!-- Flatpickr -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-messaging-compat.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 0; padding-bottom: 80px; background: #f4f4f4; direction: rtl; }
header { background: #4a90e2; color: white; padding: 15px; text-align: center; font-size: 1.5em; }
.container { max-width: 800px; margin: 20px auto; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
.form-group { margin-bottom: 16px; }
label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
input, select { width: 100%; padding: 12px; font-size: 1em; border-radius: 6px; border: 1px solid #ccc; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
th { background: #4a90e2; color: white; }
.tabs { position: fixed; bottom: 0; left: 0; width: 100%; background: #800080; display: flex; justify-content: space-around; }
.tabs button { flex: 1; padding: 15px; border: none; background: #a64ca6; color: white; font-size: 1em; cursor: pointer; }
.tabs button:hover { background: #993399; }
.tab-content { display: none; }

#popupOverlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 999; }
#popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); background: #fff; border: 2px solid #4a90e2; border-radius: 10px; padding: 20px; width: 90%; max-width: 420px; z-index: 1000; display: none; }
</style>
</head>

<body>

<header>ØªØ°ÙƒÙŠØ± ÙˆÙØ§Ø¡</header>

<div class="container">

<!-- ØªØ¨ÙˆÙŠØ¨ ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯ -->
<div id="tab-new" class="tab-content">
<h3 style="color:#4a90e2; text-align:center;">Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯</h3>

<div class="form-group">
<label>Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒÙŠØ±:</label>
<select id="type">
<option value="ØªØ°Ø§ÙƒØ±">ØªØ°Ø§ÙƒØ±</option>
<option value="Ø¹Ù…Ø±Ø©">Ø¹Ù…Ø±Ø©</option>
<option value="ØªØ£Ø´ÙŠØ±Ø§Øª">ØªØ£Ø´ÙŠØ±Ø§Øª</option>
<option value="Ø¢Ø®Ø±">Ø¢Ø®Ø±</option>
</select>
</div>

<div class="form-group">
<label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
<input type="text" id="title">
</div>

<div class="form-group">
<label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ°ÙƒÙŠØ±:</label>
<input type="text" id="date">
</div>

<div class="form-group">
<label>Ø§Ù„ÙˆÙ‚Øª:</label>
<input type="text" id="time">
</div>

<button onclick="addReminder()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±</button>
<br><br>
<button id="enablePush">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
<br><br>
<button onclick="testSound()">ğŸ”Š Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª</button>
</div>

<!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
<div id="tab-upcoming" class="tab-content">
<h3>Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
<table id="upcomingTable">
<thead>
<tr>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„ÙˆÙ‚Øª</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="popupOverlay"></div>
<div id="popup">
<h3>ğŸ”” ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªØ°ÙƒÙŠØ±</h3>
<p id="popupText"></p>
<button onclick="closePopup()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
let reminders = [];

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBvzdxIg12wzWobOco5WmcWR5oVdoVnsTM",
  authDomain: "reminders-app-5c038.firebaseapp.com",
  projectId: "reminders-app-5c038",
  storageBucket: "reminders-app-5c038.appspot.com",
  messagingSenderId: "864515961662",
  appId: "1:864515961662:web:4d6afea2d97d07d859b26f",
  measurementId: "G-MQVVLYJ4H3"
};
firebase.initializeApp(firebaseConfig);
const messaging = firebase.messaging();

const vapidKey = "BObrXKIcIqwJFN0gYxjNMuZ2xjE2YPIOSdj4n3TcVrfE_n_fpcxTaq12i1kT8qCKhTb1rJMCntIBmQTfrjQvQXw";

// ØªØ³Ø¬ÙŠÙ„ Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker
    .register('firebase-messaging-sw.js')
    .then(() => console.log('Service Worker Ù…Ø³Ø¬Ù‘Ù„'))
    .catch(err => console.error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ SW', err));
}

/* Ø§Ù„Ø¯ÙˆØ§Ù„ */
function testSound(){
  const audio = new Audio("https://www.soundjay.com/button/beep-07.wav");
  audio.play();
}

function addReminder(){
  const title = document.getElementById("title").value.trim();
  const type  = document.getElementById("type").value;
  const date  = document.getElementById("date").value;
  const time  = document.getElementById("time").value;

  if(!title || !date || !time){
    alert("âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  reminders.push({ title, type, date, time });
  localStorage.setItem("reminders", JSON.stringify(reminders)); // âœ… ØªØ®Ø²ÙŠÙ†
  renderTables();
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±");
}

function renderTables(){
  const tbody = document.querySelector('#upcomingTable tbody');
  tbody.innerHTML='';
  reminders.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.title}</td><td>${r.type}</td><td>${r.date}</td><td>${r.time}</td>`;
    tbody.appendChild(tr);
  });
}

function openPopup(text){
  document.getElementById('popupText').textContent=text;
  document.getElementById('popupOverlay').style.display='block';
  document.getElementById('popup').style.display='block';
}

function closePopup(){
  document.getElementById('popupOverlay').style.display='none';
  document.getElementById('popup').style.display='none';
}

function showTab(tab){
  document.querySelectorAll('.tab-content').forEach(el=>el.style.display='none');
  document.getElementById(tab).style.display='block';
}

window.onload = () => {
  // âœ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  const saved = localStorage.getItem("reminders");
  if (saved) {
    reminders = JSON.parse(saved);
    renderTables();
  }

  document.getElementById('enablePush').addEventListener('click', async () => {
    const permission = await Notification.requestPermission();
    if (permission !== 'granted') {
      alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†');
      return;
    }
    const token = await messaging.getToken({ vapidKey });
    console.log(token);
  });

  messaging.onMessage((payload) => {
    const n = payload.notification || {};
    const d = payload.data || {};
    openPopup(n.body || d.body || '');
    new Audio("https://www.soundjay.com/button/beep-07.wav").play();
  });

  flatpickr("#date",{locale:"ar",dateFormat:"Y-m-d"});
  flatpickr("#time",{enableTime:true,noCalendar:true,dateFormat:"H:i",time_24hr:true});

  showTab('tab-new');
};

// âœ… ÙØ­Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
setInterval(() => {
  const now = new Date();
  const currentDate = now.toISOString().split('T')[0]; // YYYY-MM-DD
  const currentTime = now.toTimeString().slice(0,5);   // HH:MM

  reminders.forEach(r => {
    if (r.date === currentDate && r.time === currentTime) {
      openPopup(`ğŸ”” ${r.title} - ${r.type}`);
      new Audio("https://www.soundjay.com/button/beep-07.wav").play();
    }
  });
}, 60000); // ÙƒÙ„ 60 Ø«Ø§Ù†ÙŠØ©
</script>

<div class="tabs">
  <button onclick="showTab('tab-new')">â• ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯</button>
  <button onclick="showTab('tab-upcoming')">ğŸ“… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</button>
</div>

</body>
</html>
